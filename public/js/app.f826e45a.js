(function(){"use strict";var e={9501:function(e,t,a){var o=a(9242),n=a(3396);function l(e,t,a,o,l,r){const i=(0,n.up)("router-view"),s=(0,n.up)("n-scrollbar"),d=(0,n.up)("n-message-provider"),u=(0,n.up)("n-global-style"),c=(0,n.up)("n-config-provider");return(0,n.wg)(),(0,n.j4)(c,{theme:o.theme},{default:(0,n.w5)((()=>[(0,n.Wm)(d,null,{default:(0,n.w5)((()=>[(0,n.Wm)(s,{style:{"max-height":"100vh"}},{default:(0,n.w5)((()=>[(0,n.Wm)(i)])),_:1})])),_:1}),(0,n.Wm)(u)])),_:1},8,["theme"])}var r=a(4870),i=a(6224),s={async initTable(){return(0,i.dw)("init_table")},async addImagesMeta(e){return(0,i.dw)("add_images_meta",e)},async getImagesMetaList(e,t,a){const o={search:e,page:t,pageSize:a};return(0,i.dw)("get_images_meta_list",o)},async getFileMetaList(e,t,a){const o={search:e,page:t,pageSize:a};return(0,i.dw)("get_file_meta_list",o)},async getImagesFolderInfo(e){return(0,i.dw)("get_images_folder_info",{pathStr:e})},async getImagesMeta(e){return(0,i.dw)("get_images_meta",{id:e})},async updateBrowseSettings(e,t,a,o,n){return(0,i.dw)("update_browse_settings",{metaId:e,browseType:t,homePage:a,currentPath:o,currentIndex:n})},async getBrowseSettings(e){return(0,i.dw)("get_browse_settings",{metaId:e})},async deleteImageMeta(e){return(0,i.dw)("delete_images_meta",{id:e})},async updateImagesMeta(e){return(0,i.dw)("update_images_meta",e)},async uploadFile(e,t,a){return(0,i.dw)("upload_file",{bytes:e,fileName:t,fileType:a})},async hideWindow(){return(0,i.dw)("hide_window")}},d=a(254),u=a(2185),c=a(3820),m=a(4629),p=a(6720),g={name:"App",components:{NConfigProvider:d.Z,NGlobalStyle:u.Z,NMessageProvider:c.Z,NScrollbar:m.Z},setup(){s.initTable().then((e=>{console.log("initTable",e)}));let e=(0,r.iH)(null);return e=p.$,{darkTheme:p.$,theme:e}}},f=a(89);const w=(0,f.Z)(g,[["render",l]]);var h=w,v=a(2483);const y={style:{margin:"20px 0"}},b={key:0,style:{"margin-top":"78px"}},_={key:1,style:{margin:"12px"}},I=["src"],k={style:{float:"right"}};function W(e,t,a,l,r,i){const s=(0,n.up)("Search"),d=(0,n.up)("n-icon"),u=(0,n.up)("n-input"),c=(0,n.up)("images-outline"),m=(0,n.up)("n-button"),p=(0,n.up)("n-space"),g=(0,n.up)("n-empty"),f=(0,n.up)("image-card"),w=(0,n.up)("n-grid-item"),h=(0,n.up)("n-grid"),v=(0,n.up)("n-pagination"),W=(0,n.up)("folder-open-outline"),C=(0,n.up)("n-form-item"),x=(0,n.up)("n-form"),M=(0,n.up)("n-card"),S=(0,n.up)("n-modal");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n._)("div",y,[(0,n.Wm)(p,{justify:"center",size:30},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{round:"",placeholder:"搜索标题或作者",value:l.data.search,"onUpdate:value":t[0]||(t[0]=e=>l.data.search=e),style:{width:"400px"},onKeyup:l.onSearchInputKeyUp,onClear:t[1]||(t[1]=()=>{l.data.search="",l.getImagesMetaList()}),clearable:""},{suffix:(0,n.w5)((()=>[(0,n.Wm)(d,null,{default:(0,n.w5)((()=>[(0,n.Wm)(s)])),_:1})])),_:1},8,["value","onKeyup"]),(0,n.Wm)(m,{strong:"",secondary:"",round:"",type:"primary",onClick:l.showAddImagesMeta},{icon:(0,n.w5)((()=>[(0,n.Wm)(d,null,{default:(0,n.w5)((()=>[(0,n.Wm)(c)])),_:1})])),default:(0,n.w5)((()=>[(0,n.Uk)(" 导入图片 ")])),_:1},8,["onClick"])])),_:1})]),0===l.data.metaList.length?((0,n.wg)(),(0,n.iD)("div",b,[(0,n.Wm)(g,{description:"现在这里还没有内容"},{extra:(0,n.w5)((()=>[(0,n.Wm)(m,{strong:"",secondary:"",round:"",type:"primary",onClick:t[2]||(t[2]=e=>l.data.modal.visible=!0)},{icon:(0,n.w5)((()=>[(0,n.Wm)(d,null,{default:(0,n.w5)((()=>[(0,n.Wm)(c)])),_:1})])),default:(0,n.w5)((()=>[(0,n.Uk)(" 导入图片 ")])),_:1})])),_:1})])):((0,n.wg)(),(0,n.iD)("div",_,[(0,n.Wm)(h,{"x-gap":12,"y-gap":8,cols:"1 2xs:1 xs:2 s:4 m:5 l:6 xl:7 2xl:8",responsive:"screen"},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(l.data.metaList,(e=>((0,n.wg)(),(0,n.j4)(w,{key:e.id},{default:(0,n.w5)((()=>[(0,n.Wm)(f,{"images-meta":e,onRemove:l.removeImagesMeta,onUpdate:l.showUpdateImagesMeta},null,8,["images-meta","onRemove","onUpdate"])])),_:2},1024)))),128))])),_:1}),(0,n.Wm)(p,{justify:"end",style:{"margin-top":"20px"}},{default:(0,n.w5)((()=>[(0,n.Wm)(v,{page:l.data.pagination.current,"onUpdate:page":t[3]||(t[3]=e=>l.data.pagination.current=e),"item-count":l.data.pagination.total,"page-size":l.data.pagination.pageSize,"onUpdate:page-size":t[4]||(t[4]=e=>l.data.pagination.pageSize=e),"page-sizes":[10,20,30,50],"show-size-picker":""},null,8,["page","item-count","page-size"])])),_:1})])),(0,n.Wm)(S,{show:l.data.modal.visible,"onUpdate:show":t[12]||(t[12]=e=>l.data.modal.visible=e)},{default:(0,n.w5)((()=>[(0,n.Wm)(M,{style:{width:"650px"},title:(l.data.modal.form.id?"更新":"导入")+"图片",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{"header-extra":(0,n.w5)((()=>[(0,n.Wm)(m,{strong:"",secondary:"",round:"",type:"primary",onClick:l.selectFolder},{icon:(0,n.w5)((()=>[(0,n.Wm)(d,null,{default:(0,n.w5)((()=>[(0,n.Wm)(W)])),_:1})])),default:(0,n.w5)((()=>[(0,n.Uk)(" 选择目录 ")])),_:1},8,["onClick"])])),footer:(0,n.w5)((()=>[(0,n._)("span",k,[l.data.modal.form.id?((0,n.wg)(),(0,n.j4)(m,{key:0,strong:"",round:"",type:"primary",onClick:l.updateImagesMeta},{default:(0,n.w5)((()=>[(0,n.Uk)("更新")])),_:1},8,["onClick"])):((0,n.wg)(),(0,n.j4)(m,{key:1,strong:"",round:"",type:"primary",onClick:l.addImagesMeta},{default:(0,n.w5)((()=>[(0,n.Uk)("添加")])),_:1},8,["onClick"]))])])),default:(0,n.w5)((()=>[(0,n.Wm)(h,{cols:7,"x-gap":20},{default:(0,n.w5)((()=>[(0,n.Wm)(w,{span:"4"},{default:(0,n.w5)((()=>[(0,n.Wm)(x,{ref:"imagesMetaForm",model:l.data.modal.form,rules:l.data.modal.rules},{default:(0,n.w5)((()=>[(0,n.Wm)(C,{path:"title",label:"标题"},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{value:l.data.modal.form.title,"onUpdate:value":t[5]||(t[5]=e=>l.data.modal.form.title=e),onKeydown:t[6]||(t[6]=(0,o.D2)((0,o.iM)((()=>{}),["prevent"]),["enter"]))},null,8,["value"])])),_:1}),(0,n.Wm)(C,{path:"author",label:"作者"},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{value:l.data.modal.form.author,"onUpdate:value":t[7]||(t[7]=e=>l.data.modal.form.author=e),onKeydown:t[8]||(t[8]=(0,o.D2)((0,o.iM)((()=>{}),["prevent"]),["enter"]))},null,8,["value"])])),_:1}),(0,n.Wm)(C,{path:"intro",label:"简介"},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{value:l.data.modal.form.intro,"onUpdate:value":t[9]||(t[9]=e=>l.data.modal.form.intro=e),type:"textarea",onKeydown:t[10]||(t[10]=(0,o.D2)((0,o.iM)((()=>{}),["prevent"]),["enter"]))},null,8,["value"])])),_:1})])),_:1},8,["model","rules"])])),_:1}),(0,n.Wm)(w,{span:"3"},{default:(0,n.w5)((()=>[(0,n._)("img",{src:l.data.modal.coverAsset,class:"modal-cover",onClick:t[11]||(t[11]=(...e)=>l.changeCover&&l.changeCover(...e))},null,8,I)])),_:1})])),_:1})])),_:1},8,["title"])])),_:1},8,["show"])])}var C=a(4329),x=a(5393),M=a(6973),S=a(3149),Z=a(9522),P=a(3273),U=a(7646),N=a(6914),z=a(8114),T=a(5210),j=a(8042),D=a(5396),F=a(7369),L=a(1260),O=a(9441),B=a(140),q=a(8364),K=a(7139);const A={key:1,class:"image-card-intro"};function R(e,t,a,o,l,r){const i=(0,n.up)("n-text"),s=(0,n.up)("n-blockquote"),d=(0,n.up)("n-dynamic-tags"),u=(0,n.up)("Pencil"),c=(0,n.up)("n-icon"),m=(0,n.up)("n-button"),p=(0,n.up)("TrashBin"),g=(0,n.up)("n-popconfirm"),f=(0,n.up)("n-space"),w=(0,n.up)("n-card"),h=(0,n.Q2)("lazy");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(w,{size:"small",hoverable:""},{cover:(0,n.w5)((()=>[(0,n.wy)((0,n._)("img",{class:"image-card-cover",onClick:t[0]||(t[0]=(...e)=>o.browseImages&&o.browseImages(...e))},null,512),[[h,o.convertFileSrc(a.imagesMeta.cover)]])])),header:(0,n.w5)((()=>[(0,n._)("span",{class:"image-card-title",onClick:t[1]||(t[1]=(...e)=>o.browseImages&&o.browseImages(...e))},(0,K.zw)(a.imagesMeta.title),1)])),action:(0,n.w5)((()=>[(0,n.Wm)(d,{type:"success",value:o.data.tags,"onUpdate:value":[t[2]||(t[2]=e=>o.data.tags=e),o.onUpdate],onCreate:o.onCreate},null,8,["value","onCreate","onUpdate:value"]),(0,n.Wm)(f,{justify:"space-around",size:10},{default:(0,n.w5)((()=>[(0,n.Wm)(m,{text:"",onClick:t[3]||(t[3]=e=>o.emit("update",Object.assign({},a.imagesMeta)))},{icon:(0,n.w5)((()=>[(0,n.Wm)(c,null,{default:(0,n.w5)((()=>[(0,n.Wm)(u)])),_:1})])),default:(0,n.w5)((()=>[(0,n.Uk)(" 编辑 ")])),_:1}),(0,n.Wm)(g,{onPositiveClick:t[4]||(t[4]=e=>o.emit("remove",a.imagesMeta.id)),"positive-text":"没错","negative-text":"算了"},{trigger:(0,n.w5)((()=>[(0,n.Wm)(m,{text:"",type:"error"},{icon:(0,n.w5)((()=>[(0,n.Wm)(c,null,{default:(0,n.w5)((()=>[(0,n.Wm)(p)])),_:1})])),default:(0,n.w5)((()=>[(0,n.Uk)(" 移除 ")])),_:1})])),default:(0,n.w5)((()=>[(0,n.Uk)(" 真的要移除吗？ ")])),_:1})])),_:1})])),default:(0,n.w5)((()=>[(0,n._)("div",null,[a.imagesMeta.author?((0,n.wg)(),(0,n.j4)(i,{key:0,type:"info"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,K.zw)(a.imagesMeta.author),1)])),_:1})):(0,n.kq)("",!0),a.imagesMeta.intro?((0,n.wg)(),(0,n.iD)("div",A,[(0,n.Wm)(s,{"align-text":""},{default:(0,n.w5)((()=>[(0,n.Uk)((0,K.zw)(a.imagesMeta.intro),1)])),_:1})])):(0,n.kq)("",!0)])])),_:1})])}a(7658);var H=a(2040),$=a(212),E=a(3513),Y=a(2124),G=a(6473),Q=a(6967),X={name:"ImageCard",components:{NCard:Z.ZP,NBlockquote:H.Z,NText:$.Z,NIcon:j.g,NButton:x.ZP,NSpace:D.Z,Pencil:G.Z,TrashBin:Q.Z,NPopconfirm:E.Z,NDynamicTags:Y.Z},props:{imagesMeta:Object},emits:["remove","update"],setup(e,t){const a=(0,v.tv)();let o=(0,r.qj)({tags:[{label:"你没见过不等于没有",value:"hello world 1"},{label:"不要给自己设限",value:"hello world 2"},{label:"不要说连升两级",value:"hello world 3"},{label:"直接升到 CEO 都是有可能的",value:"hello world 4"}]});function n(e){return{label:e,value:"v"+e}}function l(e){alert(e)}async function s(){a.push({path:"/drag",query:{}})}return{emit:t.emit,data:o,convertFileSrc:i.Lk,browseImages:s,onCreate:n,onUpdate:l}}};const J=(0,f.Z)(X,[["render",R],["__scopeId","data-v-10f3efce"]]);var V=J,ee={name:"MyLibrary",components:{ImageCard:V,FolderOpenOutline:O.Z,ImagesOutline:B.Z,NButton:x.ZP,NEmpty:M.Z,NModal:S.Z,NCard:Z.ZP,NForm:P.Z,NFormItem:U.ZP,NInput:N.Z,NGrid:z.Z,NGridItem:T.ZP,NIcon:j.g,NSpace:D.Z,NPagination:F.Z,Search:q.Z},setup(){const e=(0,L.U)(),t=(0,r.qj)({metaList:[],search:"",pagination:{current:1,pageSize:50,total:0},modal:{visible:!1,form:{id:null,title:"",author:"",intro:""},rules:{title:{required:!0,trigger:["focus","input","blur"],message:"请输入标题"}},path:"",cover:"",coverAsset:""}}),a=(0,r.iH)(null);function o(){t.modal={visible:!1,form:{id:null,title:"",author:"",intro:""},rules:{title:{required:!0,trigger:["focus","input","blur"],message:"请输入标题"}},path:"",cover:"",coverAsset:""}}async function l(){const e=t.pagination.current,a=t.pagination.pageSize;return s.getImagesMetaList(t.search.trim(),e,a).then((e=>{console.log("getImagesMetaList",e),t.metaList=e.list,t.pagination.current=e.pagination.current,t.pagination.pageSize=e.pagination.page_size,t.pagination.total=e.pagination.total}))}async function d(){C.WZ.open({title:"选择图片目录",directory:!0}).then((e=>(console.log("选择目录结果",e),s.getImagesFolderInfo(e).then((a=>{function o(){for(let e of a.files)if(!e.is_dir)return e.path;for(let e of a.files)if(e.is_dir)for(let t of e.files)return t}console.log("getImagesFolderInfo",e,a),t.modal.cover=o(),t.modal.coverAsset=(0,i.Lk)(t.modal.cover),t.modal.path=e,t.modal.form.title=a.name})))))}async function u(){return new Promise(((e,o)=>{a.value?.validate((a=>{if(!a){const a={path:t.modal.path,title:t.modal.form.title,author:t.modal.form.author||"",intro:t.modal.form.intro||"",cover:t.modal.cover};s.addImagesMeta(a).then((t=>{console.log("addImagesMeta",t),e(t)}),(e=>{o(e)}))}}))})).then((()=>(o(),l())))}async function c(){C.WZ.open({title:"选择封面",directory:!1,defaultPath:t.modal.path,filters:[{name:"image",extensions:["jpeg","jpg","webp","gif","png","bmp"]}]}).then((e=>{t.modal.cover=e,t.modal.coverAsset=(0,i.Lk)(t.modal.cover)}))}async function m(t){return console.log("removeImagesMeta",t),s.deleteImageMeta(t).then((()=>l()),(t=>{e.error(`移除失败：${t}`)}))}function p(e){console.log("showUpdateImagesMeta",e),t.modal={visible:!0,form:{id:e.id,title:e.title,author:e.author,intro:e.intro},rules:{title:{required:!0,trigger:["focus","input","blur"],message:"请输入标题"}},path:e.path,cover:e.cover,coverAsset:(0,i.Lk)(e.cover)}}function g(){o(),t.modal.visible=!0}async function f(){return new Promise(((e,o)=>{a.value?.validate((a=>{if(!a){const a={id:t.modal.form.id,path:t.modal.path,title:t.modal.form.title,author:t.modal.form.author||"",intro:t.modal.form.intro||"",cover:t.modal.cover};s.updateImagesMeta(a).then((t=>{console.log("updateImagesMeta",t),e(t)}),(e=>{o(e)}))}}))})).then((()=>(o(),l())))}function w(e){console.log("onSearchInputKeyUp",e),13===e.keyCode&&l()}return(0,n.YP)((()=>[t.pagination.current,t.pagination.pageSize]),l),l(),{imagesMetaForm:a,data:t,getImagesMetaList:l,selectFolder:d,addImagesMeta:u,changeCover:c,removeImagesMeta:m,showUpdateImagesMeta:p,showAddImagesMeta:g,updateImagesMeta:f,onSearchInputKeyUp:w}}};const te=(0,f.Z)(ee,[["render",W],["__scopeId","data-v-12947ec6"]]);var ae=te;const oe={style:{margin:"20px 0"}},ne={key:0,style:{"margin-top":"78px"}},le={key:1,style:{margin:"12px"}},re=["src"],ie={style:{float:"right"}};function se(e,t,a,l,r,i){const s=(0,n.up)("menu-router"),d=(0,n.up)("n-space"),u=(0,n.up)("n-layout-sider"),c=(0,n.up)("Search"),m=(0,n.up)("n-icon"),p=(0,n.up)("n-input"),g=(0,n.up)("images-outline"),f=(0,n.up)("n-button"),w=(0,n.up)("n-empty"),h=(0,n.up)("file-card"),v=(0,n.up)("n-grid-item"),y=(0,n.up)("n-grid"),b=(0,n.up)("n-pagination"),_=(0,n.up)("folder-open-outline"),I=(0,n.up)("n-form-item"),k=(0,n.up)("n-form"),W=(0,n.up)("n-card"),C=(0,n.up)("n-modal"),x=(0,n.up)("n-layout-content"),M=(0,n.up)("n-layout");return(0,n.wg)(),(0,n.j4)(d,{vertical:""},{default:(0,n.w5)((()=>[(0,n.Wm)(M,{"has-sider":""},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{bordered:"","collapse-mode":"width","collapsed-width":0,width:140,collapsed:l.data.collapsed,"show-trigger":"",onCollapse:t[0]||(t[0]=e=>l.data.collapsed=!0),onExpand:t[1]||(t[1]=e=>l.data.collapsed=!1)},{default:(0,n.w5)((()=>[(0,n.Wm)(d,{justify:"center",size:20},{default:(0,n.w5)((()=>[(0,n.Wm)(s)])),_:1})])),_:1},8,["collapsed"]),(0,n.Wm)(M,null,{default:(0,n.w5)((()=>[(0,n.Wm)(x,null,{default:(0,n.w5)((()=>[(0,n._)("div",null,[(0,n._)("div",oe,[(0,n.Wm)(d,{justify:"center",size:30},{default:(0,n.w5)((()=>[(0,n.Wm)(p,{round:"",placeholder:"搜索标题",value:l.data.search,"onUpdate:value":t[2]||(t[2]=e=>l.data.search=e),style:{width:"400px"},onKeyup:l.onSearchInputKeyUp,onClear:t[3]||(t[3]=()=>{l.data.search="",l.getImagesMetaList()}),clearable:""},{suffix:(0,n.w5)((()=>[(0,n.Wm)(m,null,{default:(0,n.w5)((()=>[(0,n.Wm)(c)])),_:1})])),_:1},8,["value","onKeyup"]),(0,n.Wm)(f,{strong:"",secondary:"",round:"",type:"primary",onClick:l.showAddImagesMeta},{icon:(0,n.w5)((()=>[(0,n.Wm)(m,null,{default:(0,n.w5)((()=>[(0,n.Wm)(g)])),_:1})])),default:(0,n.w5)((()=>[(0,n.Uk)(" 导入图片 ")])),_:1},8,["onClick"])])),_:1})]),0===l.data.metaList.length?((0,n.wg)(),(0,n.iD)("div",ne,[(0,n.Wm)(w,{description:"现在这里还没有内容"},{extra:(0,n.w5)((()=>[(0,n.Wm)(f,{strong:"",secondary:"",round:"",type:"primary",onClick:t[4]||(t[4]=e=>l.data.modal.visible=!0)},{icon:(0,n.w5)((()=>[(0,n.Wm)(m,null,{default:(0,n.w5)((()=>[(0,n.Wm)(g)])),_:1})])),default:(0,n.w5)((()=>[(0,n.Uk)(" 导入图片 ")])),_:1})])),_:1})])):((0,n.wg)(),(0,n.iD)("div",le,[(0,n.Wm)(y,{"x-gap":12,"y-gap":8,cols:"1 2xs:1 xs:2 s:4 m:5 l:6 xl:7 2xl:8",responsive:"screen"},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(l.data.metaList,(e=>((0,n.wg)(),(0,n.j4)(v,{key:e.id},{default:(0,n.w5)((()=>[(0,n.Wm)(h,{"file-meta":e,onRemove:l.removeImagesMeta,onUpdate:l.showUpdateImagesMeta},null,8,["file-meta","onRemove","onUpdate"])])),_:2},1024)))),128))])),_:1}),(0,n.Wm)(d,{justify:"end",style:{"margin-top":"20px"}},{default:(0,n.w5)((()=>[(0,n.Wm)(b,{page:l.data.pagination.current,"onUpdate:page":t[5]||(t[5]=e=>l.data.pagination.current=e),"item-count":l.data.pagination.total,"page-size":l.data.pagination.pageSize,"onUpdate:page-size":t[6]||(t[6]=e=>l.data.pagination.pageSize=e),"page-sizes":[10,20,30,50],"show-size-picker":""},null,8,["page","item-count","page-size"])])),_:1})])),(0,n.Wm)(C,{show:l.data.modal.visible,"onUpdate:show":t[14]||(t[14]=e=>l.data.modal.visible=e)},{default:(0,n.w5)((()=>[(0,n.Wm)(W,{style:{width:"650px"},title:(l.data.modal.form.id?"更新":"导入")+"图片",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{"header-extra":(0,n.w5)((()=>[(0,n.Wm)(f,{strong:"",secondary:"",round:"",type:"primary",onClick:l.selectFolder},{icon:(0,n.w5)((()=>[(0,n.Wm)(m,null,{default:(0,n.w5)((()=>[(0,n.Wm)(_)])),_:1})])),default:(0,n.w5)((()=>[(0,n.Uk)(" 选择目录 ")])),_:1},8,["onClick"])])),footer:(0,n.w5)((()=>[(0,n._)("span",ie,[l.data.modal.form.id?((0,n.wg)(),(0,n.j4)(f,{key:0,strong:"",round:"",type:"primary",onClick:l.updateImagesMeta},{default:(0,n.w5)((()=>[(0,n.Uk)("更新")])),_:1},8,["onClick"])):((0,n.wg)(),(0,n.j4)(f,{key:1,strong:"",round:"",type:"primary",onClick:l.addImagesMeta},{default:(0,n.w5)((()=>[(0,n.Uk)("添加")])),_:1},8,["onClick"]))])])),default:(0,n.w5)((()=>[(0,n.Wm)(y,{cols:7,"x-gap":20},{default:(0,n.w5)((()=>[(0,n.Wm)(v,{span:"4"},{default:(0,n.w5)((()=>[(0,n.Wm)(k,{ref:"imagesMetaForm",model:l.data.modal.form,rules:l.data.modal.rules},{default:(0,n.w5)((()=>[(0,n.Wm)(I,{path:"title",label:"标题"},{default:(0,n.w5)((()=>[(0,n.Wm)(p,{value:l.data.modal.form.title,"onUpdate:value":t[7]||(t[7]=e=>l.data.modal.form.title=e),onKeydown:t[8]||(t[8]=(0,o.D2)((0,o.iM)((()=>{}),["prevent"]),["enter"]))},null,8,["value"])])),_:1}),(0,n.Wm)(I,{path:"author",label:"作者"},{default:(0,n.w5)((()=>[(0,n.Wm)(p,{value:l.data.modal.form.author,"onUpdate:value":t[9]||(t[9]=e=>l.data.modal.form.author=e),onKeydown:t[10]||(t[10]=(0,o.D2)((0,o.iM)((()=>{}),["prevent"]),["enter"]))},null,8,["value"])])),_:1}),(0,n.Wm)(I,{path:"intro",label:"简介"},{default:(0,n.w5)((()=>[(0,n.Wm)(p,{value:l.data.modal.form.intro,"onUpdate:value":t[11]||(t[11]=e=>l.data.modal.form.intro=e),type:"textarea",onKeydown:t[12]||(t[12]=(0,o.D2)((0,o.iM)((()=>{}),["prevent"]),["enter"]))},null,8,["value"])])),_:1})])),_:1},8,["model","rules"])])),_:1}),(0,n.Wm)(v,{span:"3"},{default:(0,n.w5)((()=>[(0,n._)("img",{src:l.data.modal.coverAsset,class:"modal-cover",onClick:t[13]||(t[13]=(...e)=>l.changeCover&&l.changeCover(...e))},null,8,re)])),_:1})])),_:1})])),_:1},8,["title"])])),_:1},8,["show"])])])),_:1})])),_:1})])),_:1})])),_:1})}var de=a(4605),ue=a(3638),ce=a(9762);function me(e,t,a,o,l,r){const i=(0,n.up)("n-dynamic-tags"),s=(0,n.up)("Pencil"),d=(0,n.up)("n-icon"),u=(0,n.up)("n-button"),c=(0,n.up)("TrashBin"),m=(0,n.up)("n-popconfirm"),p=(0,n.up)("n-space"),g=(0,n.up)("n-card"),f=(0,n.Q2)("lazy");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(g,{size:"small",hoverable:""},{cover:(0,n.w5)((()=>[(0,n.wy)((0,n._)("img",{class:"image-card-cover",onClick:t[0]||(t[0]=(...e)=>o.browseImages&&o.browseImages(...e))},null,512),[[f,o.convertFileSrc(a.fileMeta.path)]])])),header:(0,n.w5)((()=>[(0,n._)("span",{class:"image-card-title",onClick:t[1]||(t[1]=(...e)=>o.browseImages&&o.browseImages(...e))},(0,K.zw)(a.fileMeta.orign_name),1)])),action:(0,n.w5)((()=>[(0,n.Wm)(i,{type:"success",value:o.data.tags,"onUpdate:value":[t[2]||(t[2]=e=>o.data.tags=e),o.onUpdate],onCreate:o.onCreate},null,8,["value","onCreate","onUpdate:value"]),(0,n.Wm)(p,{justify:"space-around",size:10},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{text:"",onClick:t[3]||(t[3]=e=>o.emit("update",Object.assign({},a.fileMeta)))},{icon:(0,n.w5)((()=>[(0,n.Wm)(d,null,{default:(0,n.w5)((()=>[(0,n.Wm)(s)])),_:1})])),default:(0,n.w5)((()=>[(0,n.Uk)(" 编辑 ")])),_:1}),(0,n.Wm)(m,{onPositiveClick:t[4]||(t[4]=e=>o.emit("remove",a.fileMeta.id)),"positive-text":"没错","negative-text":"算了"},{trigger:(0,n.w5)((()=>[(0,n.Wm)(u,{text:"",type:"error"},{icon:(0,n.w5)((()=>[(0,n.Wm)(d,null,{default:(0,n.w5)((()=>[(0,n.Wm)(c)])),_:1})])),default:(0,n.w5)((()=>[(0,n.Uk)(" 移除 ")])),_:1})])),default:(0,n.w5)((()=>[(0,n.Uk)(" 真的要移除吗？ ")])),_:1})])),_:1})])),_:1})])}var pe={name:"FileCard",components:{NCard:Z.ZP,NIcon:j.g,NButton:x.ZP,NSpace:D.Z,Pencil:G.Z,TrashBin:Q.Z,NPopconfirm:E.Z,NDynamicTags:Y.Z},props:{fileMeta:Object},emits:["remove","update"],setup(e,t){const a=(0,v.tv)();let o=(0,r.qj)({tags:[{label:"你没见过不等于没有",value:"hello world 1"},{label:"不要给自己设限",value:"hello world 2"},{label:"不要说连升两级",value:"hello world 3"},{label:"直接升到 CEO 都是有可能的",value:"hello world 4"}]});function n(e){return{label:e,value:"v"+e}}function l(e){alert(e)}async function s(){a.push({path:"/browse",query:{id:e.fileMeta.id}})}return{emit:t.emit,data:o,convertFileSrc:i.Lk,browseImages:s,onCreate:n,onUpdate:l}}};const ge=(0,f.Z)(pe,[["render",me],["__scopeId","data-v-1c4198e4"]]);var fe=ge;function we(e,t,a,o,l,r){const i=(0,n.up)("n-menu");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(i,{options:o.data.menuOptions},null,8,["options"])])}var he=a(736),ve=a(3380),ye={name:"MenuRouter",components:{NMenu:he.Z},setup(){function e(e){return()=>(0,n.h)(j.g,null,{default:()=>(0,n.h)(e)})}let t=(0,r.qj)({menuOptions:[{label:()=>(0,n.h)(v.rH,{to:{path:"/"}},{default:()=>"我的图库"}),key:"mylib",icon:e(ve.MdImages)},{label:()=>(0,n.h)(v.rH,{to:{path:"/"}},{default:()=>"我的图库"}),key:"mylib",icon:e(ve.MdImages)}]});return{data:t}}};const be=(0,f.Z)(ye,[["render",we]]);var _e=be,Ie={name:"MyLibrary",components:{FileCard:fe,MenuRouter:_e,FolderOpenOutline:O.Z,ImagesOutline:B.Z,NLayout:de.ZP,NLayoutSider:ue.Z,NLayoutContent:ce.Z,NButton:x.ZP,NEmpty:M.Z,NModal:S.Z,NCard:Z.ZP,NForm:P.Z,NFormItem:U.ZP,NInput:N.Z,NGrid:z.Z,NGridItem:T.ZP,NIcon:j.g,NSpace:D.Z,NPagination:F.Z,Search:q.Z},setup(){const e=(0,L.U)(),t=(0,r.qj)({collapsed:!0,metaList:[],search:"",pagination:{current:1,pageSize:50,total:0},modal:{visible:!1,form:{id:null,title:"",author:"",intro:""},rules:{title:{required:!0,trigger:["focus","input","blur"],message:"请输入标题"}},path:"",cover:"",coverAsset:""}}),a=(0,r.iH)(null);function o(){t.modal={visible:!1,form:{id:null,title:"",author:"",intro:""},rules:{title:{required:!0,trigger:["focus","input","blur"],message:"请输入标题"}},path:"",cover:"",coverAsset:""}}async function l(){const e=t.pagination.current,a=t.pagination.pageSize;return s.getFileMetaList(t.search.trim(),e,a).then((e=>{console.log("getFileMetaList",e),t.metaList=e.list,t.pagination.current=e.pagination.current,t.pagination.pageSize=e.pagination.page_size,t.pagination.total=e.pagination.total}))}async function d(){C.WZ.open({title:"选择图片目录",directory:!0}).then((e=>(console.log("选择目录结果",e),s.getImagesFolderInfo(e).then((a=>{function o(){for(let e of a.files)if(!e.is_dir)return e.path;for(let e of a.files)if(e.is_dir)for(let t of e.files)return t}console.log("getImagesFolderInfo",e,a),t.modal.cover=o(),t.modal.coverAsset=(0,i.Lk)(t.modal.cover),t.modal.path=e,t.modal.form.title=a.name})))))}async function u(){return new Promise(((e,o)=>{a.value?.validate((a=>{if(!a){const a={path:t.modal.path,title:t.modal.form.title,author:t.modal.form.author||"",intro:t.modal.form.intro||"",cover:t.modal.cover};s.addImagesMeta(a).then((t=>{console.log("addImagesMeta",t),e(t)}),(e=>{o(e)}))}}))})).then((()=>(o(),l())))}async function c(){C.WZ.open({title:"选择封面",directory:!1,defaultPath:t.modal.path,filters:[{name:"image",extensions:["jpeg","jpg","webp","gif","png","bmp"]}]}).then((e=>{t.modal.cover=e,t.modal.coverAsset=(0,i.Lk)(t.modal.cover)}))}async function m(t){return console.log("removeImagesMeta",t),s.deleteImageMeta(t).then((()=>l()),(t=>{e.error(`移除失败：${t}`)}))}function p(e){console.log("showUpdateImagesMeta",e),t.modal={visible:!0,form:{id:e.id,title:e.title,author:e.author,intro:e.intro},rules:{title:{required:!0,trigger:["focus","input","blur"],message:"请输入标题"}},path:e.path,cover:e.cover,coverAsset:(0,i.Lk)(e.cover)}}function g(){o(),t.modal.visible=!0}async function f(){return new Promise(((e,o)=>{a.value?.validate((a=>{if(!a){const a={id:t.modal.form.id,path:t.modal.path,title:t.modal.form.title,author:t.modal.form.author||"",intro:t.modal.form.intro||"",cover:t.modal.cover};s.updateImagesMeta(a).then((t=>{console.log("updateImagesMeta",t),e(t)}),(e=>{o(e)}))}}))})).then((()=>(o(),l())))}function w(e){console.log("onSearchInputKeyUp",e),13===e.keyCode&&l()}return(0,n.YP)((()=>[t.pagination.current,t.pagination.pageSize]),l),l(),{imagesMetaForm:a,data:t,getImagesMetaList:l,selectFolder:d,addImagesMeta:u,changeCover:c,removeImagesMeta:m,showUpdateImagesMeta:p,showAddImagesMeta:g,updateImagesMeta:f,onSearchInputKeyUp:w}}};const ke=(0,f.Z)(Ie,[["render",se],["__scopeId","data-v-41d41e61"]]);var We=ke;const Ce={class:"top-hover-area"},xe={class:"carousel-img"},Me={class:"carousel-double-img-container"},Se={key:0,class:"carousel-double-img"},Ze={class:"carousel-double-img-container"},Pe={key:0,class:"carousel-double-img"},Ue={key:3,style:{margin:"0 auto"}},Ne=["id"],ze=["id"],Te=["onClick"];function je(e,t,a,o,l,r){const i=(0,n.up)("ArrowBackCircleOutline"),s=(0,n.up)("n-icon"),d=(0,n.up)("n-button"),u=(0,n.up)("n-text"),c=(0,n.up)("n-divider"),m=(0,n.up)("n-radio"),p=(0,n.up)("n-radio-group"),g=(0,n.up)("n-switch"),f=(0,n.up)("n-list-item"),w=(0,n.up)("n-list"),h=(0,n.up)("n-layout-sider"),v=(0,n.up)("n-carousel-item"),y=(0,n.up)("n-carousel"),b=(0,n.up)("n-layout-content"),_=(0,n.up)("n-layout"),I=(0,n.up)("n-space"),k=(0,n.Q2)("lazy");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n._)("div",Ce,[(0,n.Wm)(d,{text:"",class:"back-button",onClick:o.goBack},{icon:(0,n.w5)((()=>[(0,n.Wm)(s,{size:"30"},{default:(0,n.w5)((()=>[(0,n.Wm)(i)])),_:1})])),_:1},8,["onClick"])]),(0,n.Wm)(_,{"has-sider":"","sider-placement":"right",class:"screen-height"},{default:(0,n.w5)((()=>[(0,n.Wm)(b,{class:"screen-height"},{default:(0,n.w5)((()=>[(0,n.Wm)(_,{"has-sider":"",class:"screen-height"},{default:(0,n.w5)((()=>[(0,n.Wm)(h,{"collapse-mode":"transform","collapsed-width":4,width:240,"show-collapsed-content":!1,"show-trigger":"arrow-circle",collapsed:o.data.chaptersCollapsed,"content-style":"padding: 0px 24px;","native-scrollbar":!1,onCollapse:t[3]||(t[3]=e=>o.data.chaptersCollapsed=!0),onExpand:t[4]||(t[4]=e=>o.data.chaptersCollapsed=!1)},{default:(0,n.w5)((()=>[(0,n._)("div",null,[(0,n.Wm)(c,{"title-placement":"left"},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{depth:"3"},{default:(0,n.w5)((()=>[(0,n.Uk)(" 浏览设置 ")])),_:1})])),_:1}),(0,n._)("div",null,[(0,n.Wm)(p,{value:o.data.browseSettings.browseType,"onUpdate:value":t[0]||(t[0]=e=>o.data.browseSettings.browseType=e),size:"small"},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(o.data.browseSettings.browseTypes,(e=>((0,n.wg)(),(0,n.j4)(m,{style:{padding:"2px 5px"},key:e.type,value:e.type,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["value"]),(0,n.Wm)(g,{value:o.data.browseSettings.homePage,"onUpdate:value":t[1]||(t[1]=e=>o.data.browseSettings.homePage=e),style:{"margin-top":"15px"},disabled:o.data.browseSettings.browseType in{single:1,scroll:1}},{checked:(0,n.w5)((()=>[(0,n.Uk)(" 有首页 ")])),unchecked:(0,n.w5)((()=>[(0,n.Uk)(" 无首页 ")])),_:1},8,["value","disabled"])]),(0,n.Wm)(c,{"title-placement":"left"},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{depth:"3"},{default:(0,n.w5)((()=>[(0,n.Uk)(" 子目录 ")])),_:1})])),_:1}),o.data.folderInfo.files?((0,n.wg)(),(0,n.j4)(w,{key:0},{default:(0,n.w5)((()=>[(0,n.Wm)(f,null,{default:(0,n.w5)((()=>[(0,n.Wm)(u,{class:"chapter-item",type:""+(""===o.data.currentPath?"info":"default"),onClick:t[2]||(t[2]=e=>o.selectChapter(""))},{default:(0,n.w5)((()=>[(0,n.Uk)(" [默认] ("+(0,K.zw)(o.data.folderInfo.files.filter((e=>!e.is_dir)).length)+"P) ",1)])),_:1},8,["type"])])),_:1}),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(o.data.folderInfo.files.filter((e=>e.is_dir)),(e=>((0,n.wg)(),(0,n.j4)(f,{key:e.path},{default:(0,n.w5)((()=>[(0,n.Wm)(u,{class:"chapter-item",type:""+(o.data.currentPath===e.path?"info":"default"),onClick:t=>o.selectChapter(e.path)},{default:(0,n.w5)((()=>[(0,n.Uk)((0,K.zw)(e.name)+" ("+(0,K.zw)(e.files.length)+"P) ",1)])),_:2},1032,["type","onClick"])])),_:2},1024)))),128))])),_:1})):(0,n.kq)("",!0)])])),_:1},8,["collapsed"]),(0,n.Wm)(b,{onClick:t[5]||(t[5]=e=>o.data.chaptersCollapsed=!0),"native-scrollbar":!1,ref:"contentRef"},{default:(0,n.w5)((()=>["single"===o.data.browseSettings.browseType?((0,n.wg)(),(0,n.j4)(y,{key:0,ref:"carouselRef",effect:"fade","slides-per-view":1,style:{height:"100vh"},mousewheel:"",direction:"vertical","show-dots":!1,loop:!1,"onUpdate:currentIndex":o.onCurrentIndex},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(o.currentImages,(e=>((0,n.wg)(),(0,n.j4)(v,{class:"center",key:e.index},{default:(0,n.w5)((()=>[(0,n.wy)((0,n._)("img",xe,null,512),[[k,o.convertFileSrc(e.path)]])])),_:2},1024)))),128))])),_:1},8,["onUpdate:currentIndex"])):"right-left"===o.data.browseSettings.browseType?((0,n.wg)(),(0,n.j4)(y,{key:1,ref:"doublePageCarouselRef",effect:"fade","slides-per-view":1,style:{height:"100vh"},mousewheel:"",direction:"vertical","show-dots":!1,loop:!1,"onUpdate:currentIndex":o.onDoublePageCurrentIndex},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(o.currentImagesDoublePage,(e=>((0,n.wg)(),(0,n.j4)(v,{class:"center",key:e[0].index},{default:(0,n.w5)((()=>[(0,n._)("div",Me,[e.length>1?(0,n.wy)(((0,n.wg)(),(0,n.iD)("img",Se,null,512)),[[k,o.convertFileSrc(e[1].path)]]):(0,n.kq)("",!0),(0,n.wy)((0,n._)("img",{class:(0,K.C_)(""+(1===e.length?"carousel-img":"carousel-double-img"))},null,2),[[k,o.convertFileSrc(e[0].path)]])])])),_:2},1024)))),128))])),_:1},8,["onUpdate:currentIndex"])):"left-right"===o.data.browseSettings.browseType?((0,n.wg)(),(0,n.j4)(y,{key:2,ref:"doublePageCarouselRef",effect:"fade","slides-per-view":1,style:{height:"100vh"},mousewheel:"",direction:"vertical","show-dots":!1,loop:!1,"onUpdate:currentIndex":o.onDoublePageCurrentIndex},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(o.currentImagesDoublePage,(e=>((0,n.wg)(),(0,n.j4)(v,{class:"center",key:e[0].index},{default:(0,n.w5)((()=>[(0,n._)("div",Ze,[(0,n.wy)((0,n._)("img",{class:(0,K.C_)(""+(1===e.length?"carousel-img":"carousel-double-img"))},null,2),[[k,o.convertFileSrc(e[0].path)]]),e.length>1?(0,n.wy)(((0,n.wg)(),(0,n.iD)("img",Pe,null,512)),[[k,o.convertFileSrc(e[1].path)]]):(0,n.kq)("",!0)])])),_:2},1024)))),128))])),_:1},8,["onUpdate:currentIndex"])):"scroll"===o.data.browseSettings.browseType?((0,n.wg)(),(0,n.iD)("div",Ue,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(o.currentImages,(e=>(0,n.wy)(((0,n.wg)(),(0,n.iD)("img",{key:e.index,class:"scroll-img",id:`scroll-img-${e.index}`},null,8,Ne)),[[k,o.convertFileSrc(e.path)]]))),128))])):(0,n.kq)("",!0)])),_:1},512)])),_:1})])),_:1}),(0,n.Wm)(h,{ref:"siderRef",width:220,"native-scrollbar":!1,bordered:"","content-style":"padding: 20px;"},{default:(0,n.w5)((()=>[(0,n.Wm)(I,{vertical:""},{default:(0,n.w5)((()=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(o.currentImages,(e=>((0,n.wg)(),(0,n.iD)("div",{key:e.index,id:`preview-${e.index}`},[(0,n.wy)((0,n._)("img",{class:(0,K.C_)(""+(o.data.activeImageIndex===e.index?"preview-img-active":"preview-img")),onClick:t=>o.onPreviewImageClick(e.index)},null,10,Te),[[k,o.convertFileSrc(e.path)]])],8,ze)))),128))])),_:1})])),_:1},512)])),_:1})])}var De=a(568),Fe=a(7602),Le=a(796),Oe=a(7745),Be=a(9332),qe=a(711),Ke=a(3105),Ae=a(246),Re=a(5740),He={name:"ImageBrowser",components:{NLayout:de.ZP,NLayoutSider:ue.Z,NLayoutContent:ce.Z,NList:De.ZP,NListItem:Fe.Z,NText:$.Z,NCarousel:Le.C,NCarouselItem:Oe.Z,NSpace:D.Z,NRadioGroup:Be.Z,NRadio:qe.Z,NDivider:Ke.Z,NSwitch:Ae.Z,ArrowBackCircleOutline:Re.Z,NIcon:j.g,NButton:x.ZP},setup(){let e=(0,r.qj)({meta:{},folderInfo:{},currentPath:"",chaptersCollapsed:!0,activeImageIndex:0,browseSettings:{browseType:"single",browseTypes:[{type:"single",name:"单页"},{type:"scroll",name:"滚动"},{type:"right-left",name:"右左"},{type:"left-right",name:"左右"}],homePage:!1}});const t=(0,n.Fl)((()=>{if(!e.folderInfo.files)return[];if(""===e.currentPath)return e.folderInfo.files.filter((e=>!e.is_dir)).map(((e,t)=>({path:e.path,index:t})));{let t=e.folderInfo.files.filter((t=>t.path===e.currentPath))[0];return t?t.files.map(((e,t)=>({path:e,index:t}))):[]}})),a=(0,n.Fl)((()=>{if(0===t.value.length)return[];let a=[];e.browseSettings.homePage&&a.push([t.value[0]]);for(let o=e.browseSettings.homePage?1:0;o<t.value.length;o+=2){let e=[t.value[o]];o+1<t.value.length&&e.push(t.value[o+1]),a.push(e)}return a})),o=(0,r.iH)(null),l=(0,r.iH)(null),d=(0,r.iH)(null),u=(0,r.iH)(null),c=(0,v.tv)(),m=c.currentRoute.value.query;async function p(){return s.getImagesMeta(parseInt(m.id)).then((t=>{console.log("getImagesMeta",t),e.meta=t}))}async function g(t){return s.getImagesFolderInfo(t).then((t=>{console.log("getImagesFolderInfo",t),e.folderInfo=t,0===e.folderInfo.files.filter((e=>!e.is_dir)).length&&e.folderInfo.files.length>0&&(e.currentPath=e.folderInfo.files[0].path)}))}async function f(t){return s.getBrowseSettings(t).then((a=>{console.log("getBrowseSettings",t,a),e.browseSettings.browseType=a.browse_type,e.browseSettings.homePage=a.home_page,e.currentPath=a.current_path,(0,n.Y3)((()=>{setTimeout((()=>{_(a.current_index)}),200)}))}),(e=>{console.warn("getBrowseSettings err",t,e)})).then((()=>{(0,n.YP)((()=>[e.browseSettings.browseType,e.browseSettings.homePage,e.currentPath,e.activeImageIndex]),(([t,a,o,n])=>{e.meta.id&&s.updateBrowseSettings(e.meta.id,t,a,o,n).then((()=>{}),(()=>{}))}))}))}function w(t){e.currentPath=t,"single"===e.browseSettings.browseType?o.value.to(0):"left-right"!==e.browseSettings.browseType&&"right-left"!==e.browseSettings.browseType||l.value.to(0)}function h(t){e.activeImageIndex=t;const a=`preview-${e.activeImageIndex}`,o=document.getElementById(a);d.value.scrollTo({top:o.offsetTop-5,behavior:"smooth"})}function y(t){console.log("onDoublePageCurrentIndex",t),e.activeImageIndex=a.value[t][0].index;const o=`preview-${e.activeImageIndex}`,n=document.getElementById(o);d.value.scrollTo({top:n.offsetTop-5,behavior:"smooth"})}function b(t){if(e.activeImageIndex=t,"single"===e.browseSettings.browseType)o.value.to(t);else if("left-right"===e.browseSettings.browseType||"right-left"===e.browseSettings.browseType){let a;a=e.browseSettings.homePage?parseInt((t+1)/2):parseInt(t/2),l.value.to(a)}else if("scroll"===e.browseSettings.browseType){const e=`scroll-img-${t}`,a=document.getElementById(e);u.value.scrollTo({top:a.offsetTop,behavior:"smooth"})}}function _(t){e.activeImageIndex=t;const a=`preview-${e.activeImageIndex}`,o=document.getElementById(a);d.value.scrollTo({top:o.offsetTop-5,behavior:"smooth"}),b(t)}function I(){c.back()}return{data:e,currentImages:t,currentImagesDoublePage:a,convertFileSrc:i.Lk,selectChapter:w,onCurrentIndex:h,onDoublePageCurrentIndex:y,carouselRef:o,doublePageCarouselRef:l,siderRef:d,contentRef:u,onPreviewImageClick:b,getImagesMeta:p,getImagesFolderInfo:g,getBrowseSettings:f,goBack:I}},mounted(){this.getImagesMeta().then((()=>{this.getImagesFolderInfo(this.data.meta.path),this.getBrowseSettings(this.data.meta.id)}))}};const $e=(0,f.Z)(He,[["render",je],["__scopeId","data-v-2d219836"]]);var Ee=$e;const Ye=e=>((0,n.dD)("data-v-66db4572"),e=e(),(0,n.Cn)(),e),Ge=Ye((()=>(0,n._)("h4",null,"拖拽到这里上传",-1))),Qe=[Ge];function Xe(e,t,a,l,r,i){return(0,n.wy)(((0,n.wg)(),(0,n.iD)("div",{class:(0,K.C_)(["mask",l.data.changeColor]),id:"mask"},Qe,2)),[[o.F8,l.data.show]])}a(8675),a(3408),a(4590);var Je={name:"MyDrag",setup(){const e={on:"on",off:"off"};let t=(0,r.qj)({tempIndex:0,fileList:[],accept:r.iH<String>".jpg,.gif,.png,.jpeg",show:!0,changeColor:e.off});function a(a){t.changeColor=a?e.on:e.off}function o(){const e=document.querySelector("body");e&&(e.addEventListener("dragleave",(e=>{e.stopPropagation(),e.preventDefault(),a(!1)})),e.addEventListener("drop",(e=>{e.stopPropagation(),e.preventDefault(),n(e)})),e.addEventListener("dragover",(e=>{e.stopPropagation(),e.preventDefault(),a(!0)})))}const n=e=>{if(console.debug("1. 拖入事件开始",e.dataTransfer),e.dataTransfer){const d=[].slice.call(e.dataTransfer.files).filter((a=>(console.log(e.dataTransfer),!t.accept||l(a,t.accept))));t.fileList=d.map((e=>i(e))),console.debug("2. fileList为 ",t.fileList),a(!1);var o=e.dataTransfer.files;if(console.debug("3. files.length ",o.length),o.length>0){const e=o[0];var n=new FileReader,r=[];n.readAsArrayBuffer(e),n.onloadend=function(t){if(t.target.readyState==FileReader.DONE)for(var a=t.target.result,o=new Uint8Array(a),n=0;n<o.length;n++)r.push(o[n]);s.uploadFile(r,e.name,e.type).then((e=>{s.hideWindow()})),console.debug("4. 字节数组 ",r)}}}},l=(e,t="")=>{const{type:a,name:o}=e;if(0===t.length)return!0;const n=o.indexOf(".")>-1?`.${o.split(".").pop()}`:"",l=a.replace(/\/.*$/,"");return t.split(",").map((e=>e.trim())).filter((e=>e)).some((e=>/\..+$/.test(e)?n===e:/\/\*$/.test(e)?l===e.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(e)?a===e:void 0))},i=e=>(e.uid=Date.now()+t.tempIndex++,{status:"ready",name:e.name,size:e.size,percentage:0,uid:e.uid,raw:e});return o(),{data:t}}};const Ve=(0,f.Z)(Je,[["render",Xe],["__scopeId","data-v-66db4572"]]);var et=Ve;const tt=[{path:"/mylib",name:"my-lib",component:ae},{path:"/",name:"my-file-lib",component:We},{path:"/browse",name:"browse",component:Ee},{path:"/drag",name:"drag",component:et}],at=(0,v.p7)({history:(0,v.PO)(),routes:tt});var ot=at,nt=a(2644);(0,o.ri)(h).use(ot).use(nt.Z,{loading:a(8938)}).mount("#app")},8938:function(e,t,a){e.exports=a.p+"img/XOsX.816acf33.gif"}},t={};function a(o){var n=t[o];if(void 0!==n)return n.exports;var l=t[o]={exports:{}};return e[o](l,l.exports,a),l.exports}a.m=e,function(){var e=[];a.O=function(t,o,n,l){if(!o){var r=1/0;for(u=0;u<e.length;u++){o=e[u][0],n=e[u][1],l=e[u][2];for(var i=!0,s=0;s<o.length;s++)(!1&l||r>=l)&&Object.keys(a.O).every((function(e){return a.O[e](o[s])}))?o.splice(s--,1):(i=!1,l<r&&(r=l));if(i){e.splice(u--,1);var d=n();void 0!==d&&(t=d)}}return t}l=l||0;for(var u=e.length;u>0&&e[u-1][2]>l;u--)e[u]=e[u-1];e[u]=[o,n,l]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.p="/"}(),function(){var e={143:0};a.O.j=function(t){return 0===e[t]};var t=function(t,o){var n,l,r=o[0],i=o[1],s=o[2],d=0;if(r.some((function(t){return 0!==e[t]}))){for(n in i)a.o(i,n)&&(a.m[n]=i[n]);if(s)var u=s(a)}for(t&&t(o);d<r.length;d++)l=r[d],a.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return a.O(u)},o=self["webpackChunkimageview"]=self["webpackChunkimageview"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=a.O(void 0,[998],(function(){return a(9501)}));o=a.O(o)})();
//# sourceMappingURL=app.f826e45a.js.map