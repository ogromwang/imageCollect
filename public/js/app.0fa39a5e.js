(function(){"use strict";var e={9254:function(e,t,a){var n=a(9242),o=a(3396);function r(e,t,a,n,r,l){const i=(0,o.up)("router-view"),s=(0,o.up)("n-scrollbar"),u=(0,o.up)("n-message-provider"),d=(0,o.up)("n-global-style"),c=(0,o.up)("n-config-provider");return(0,o.wg)(),(0,o.j4)(c,{theme:n.theme},{default:(0,o.w5)((()=>[(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Wm)(s,{style:{"max-height":"100vh"}},{default:(0,o.w5)((()=>[(0,o.Wm)(i)])),_:1})])),_:1}),(0,o.Wm)(d)])),_:1},8,["theme"])}var l=a(4870),i=a(6224),s={async initTable(){return(0,i.dw)("init_table")},async addImagesMeta(e){return(0,i.dw)("add_images_meta",e)},async getImagesMetaList(e,t,a){const n={search:e,page:t,pageSize:a};return(0,i.dw)("get_images_meta_list",n)},async getImagesFolderInfo(e){return(0,i.dw)("get_images_folder_info",{pathStr:e})},async getImagesMeta(e){return(0,i.dw)("get_images_meta",{id:e})},async updateBrowseSettings(e,t,a,n,o){return(0,i.dw)("update_browse_settings",{metaId:e,browseType:t,homePage:a,currentPath:n,currentIndex:o})},async getBrowseSettings(e){return(0,i.dw)("get_browse_settings",{metaId:e})},async deleteImageMeta(e){return(0,i.dw)("delete_images_meta",{id:e})},async updateImagesMeta(e){return(0,i.dw)("update_images_meta",e)}},u=a(254),d=a(2185),c=a(8718),g=a(4629),m=a(2744),p={name:"App",components:{NConfigProvider:u.Z,NGlobalStyle:d.Z,NMessageProvider:c.Z,NScrollbar:g.Z},setup(){s.initTable().then((e=>{console.log("initTable",e)}));let e=(0,l.iH)(null);return e=m.$,{darkTheme:m.$,theme:e}}},f=a(89);const w=(0,f.Z)(p,[["render",r]]);var h=w,v=a(2483);const y={style:{margin:"20px 0"}},b={key:0,style:{"margin-top":"78px"}},I={key:1,style:{margin:"12px"}},_=["src"],k={style:{float:"right"}};function x(e,t,a,r,l,i){const s=(0,o.up)("Search"),u=(0,o.up)("n-icon"),d=(0,o.up)("n-input"),c=(0,o.up)("images-outline"),g=(0,o.up)("n-button"),m=(0,o.up)("n-space"),p=(0,o.up)("n-empty"),f=(0,o.up)("image-card"),w=(0,o.up)("n-grid-item"),h=(0,o.up)("n-grid"),v=(0,o.up)("n-pagination"),x=(0,o.up)("folder-open-outline"),C=(0,o.up)("n-form-item"),S=(0,o.up)("n-form"),W=(0,o.up)("n-card"),P=(0,o.up)("n-modal");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",y,[(0,o.Wm)(m,{justify:"center",size:30},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{round:"",placeholder:"搜索标题或作者",value:r.data.search,"onUpdate:value":t[0]||(t[0]=e=>r.data.search=e),style:{width:"400px"},onKeyup:r.onSearchInputKeyUp,onClear:t[1]||(t[1]=()=>{r.data.search="",r.getImagesMetaList()}),clearable:""},{suffix:(0,o.w5)((()=>[(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Wm)(s)])),_:1})])),_:1},8,["value","onKeyup"]),(0,o.Wm)(g,{strong:"",secondary:"",round:"",type:"primary",onClick:r.showAddImagesMeta},{icon:(0,o.w5)((()=>[(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Wm)(c)])),_:1})])),default:(0,o.w5)((()=>[(0,o.Uk)(" 导入图片 ")])),_:1},8,["onClick"])])),_:1})]),0===r.data.metaList.length?((0,o.wg)(),(0,o.iD)("div",b,[(0,o.Wm)(p,{description:"现在这里还没有内容"},{extra:(0,o.w5)((()=>[(0,o.Wm)(g,{strong:"",secondary:"",round:"",type:"primary",onClick:t[2]||(t[2]=e=>r.data.modal.visible=!0)},{icon:(0,o.w5)((()=>[(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Wm)(c)])),_:1})])),default:(0,o.w5)((()=>[(0,o.Uk)(" 导入图片 ")])),_:1})])),_:1})])):((0,o.wg)(),(0,o.iD)("div",I,[(0,o.Wm)(h,{"x-gap":12,"y-gap":8,cols:"1 2xs:1 xs:2 s:4 m:5 l:6 xl:7 2xl:8",responsive:"screen"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(r.data.metaList,(e=>((0,o.wg)(),(0,o.j4)(w,{key:e.id},{default:(0,o.w5)((()=>[(0,o.Wm)(f,{"images-meta":e,onRemove:r.removeImagesMeta,onUpdate:r.showUpdateImagesMeta},null,8,["images-meta","onRemove","onUpdate"])])),_:2},1024)))),128))])),_:1}),(0,o.Wm)(m,{justify:"end",style:{"margin-top":"20px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(v,{page:r.data.pagination.current,"onUpdate:page":t[3]||(t[3]=e=>r.data.pagination.current=e),"item-count":r.data.pagination.total,"page-size":r.data.pagination.pageSize,"onUpdate:page-size":t[4]||(t[4]=e=>r.data.pagination.pageSize=e),"page-sizes":[10,20,30,50],"show-size-picker":""},null,8,["page","item-count","page-size"])])),_:1})])),(0,o.Wm)(P,{show:r.data.modal.visible,"onUpdate:show":t[12]||(t[12]=e=>r.data.modal.visible=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(W,{style:{width:"650px"},title:(r.data.modal.form.id?"更新":"导入")+"图片",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{"header-extra":(0,o.w5)((()=>[(0,o.Wm)(g,{strong:"",secondary:"",round:"",type:"primary",onClick:r.selectFolder},{icon:(0,o.w5)((()=>[(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Wm)(x)])),_:1})])),default:(0,o.w5)((()=>[(0,o.Uk)(" 选择目录 ")])),_:1},8,["onClick"])])),footer:(0,o.w5)((()=>[(0,o._)("span",k,[r.data.modal.form.id?((0,o.wg)(),(0,o.j4)(g,{key:0,strong:"",round:"",type:"primary",onClick:r.updateImagesMeta},{default:(0,o.w5)((()=>[(0,o.Uk)("更新")])),_:1},8,["onClick"])):((0,o.wg)(),(0,o.j4)(g,{key:1,strong:"",round:"",type:"primary",onClick:r.addImagesMeta},{default:(0,o.w5)((()=>[(0,o.Uk)("添加")])),_:1},8,["onClick"]))])])),default:(0,o.w5)((()=>[(0,o.Wm)(h,{cols:7,"x-gap":20},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{span:"4"},{default:(0,o.w5)((()=>[(0,o.Wm)(S,{ref:"imagesMetaForm",model:r.data.modal.form,rules:r.data.modal.rules},{default:(0,o.w5)((()=>[(0,o.Wm)(C,{path:"title",label:"标题"},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{value:r.data.modal.form.title,"onUpdate:value":t[5]||(t[5]=e=>r.data.modal.form.title=e),onKeydown:t[6]||(t[6]=(0,n.D2)((0,n.iM)((()=>{}),["prevent"]),["enter"]))},null,8,["value"])])),_:1}),(0,o.Wm)(C,{path:"author",label:"作者"},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{value:r.data.modal.form.author,"onUpdate:value":t[7]||(t[7]=e=>r.data.modal.form.author=e),onKeydown:t[8]||(t[8]=(0,n.D2)((0,n.iM)((()=>{}),["prevent"]),["enter"]))},null,8,["value"])])),_:1}),(0,o.Wm)(C,{path:"intro",label:"简介"},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{value:r.data.modal.form.intro,"onUpdate:value":t[9]||(t[9]=e=>r.data.modal.form.intro=e),type:"textarea",onKeydown:t[10]||(t[10]=(0,n.D2)((0,n.iM)((()=>{}),["prevent"]),["enter"]))},null,8,["value"])])),_:1})])),_:1},8,["model","rules"])])),_:1}),(0,o.Wm)(w,{span:"3"},{default:(0,o.w5)((()=>[(0,o._)("img",{src:r.data.modal.coverAsset,class:"modal-cover",onClick:t[11]||(t[11]=(...e)=>r.changeCover&&r.changeCover(...e))},null,8,_)])),_:1})])),_:1})])),_:1},8,["title"])])),_:1},8,["show"])])}var C=a(4329),S=a(5393),W=a(6973),P=a(3149),M=a(9522),Z=a(3273),T=a(7646),U=a(6914),N=a(8114),D=a(5210),j=a(8042),F=a(5396),z=a(1984),L=a(1260),B=a(9441),O=a(140),q=a(8364),K=a(7139);const R={key:1,class:"image-card-intro"};function H(e,t,a,n,r,l){const i=(0,o.up)("n-text"),s=(0,o.up)("n-blockquote"),u=(0,o.up)("n-dynamic-tags"),d=(0,o.up)("Pencil"),c=(0,o.up)("n-icon"),g=(0,o.up)("n-button"),m=(0,o.up)("TrashBin"),p=(0,o.up)("n-popconfirm"),f=(0,o.up)("n-space"),w=(0,o.up)("n-card"),h=(0,o.Q2)("lazy");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o.Wm)(w,{size:"small",hoverable:""},{cover:(0,o.w5)((()=>[(0,o.wy)((0,o._)("img",{class:"image-card-cover",onClick:t[0]||(t[0]=(...e)=>n.browseImages&&n.browseImages(...e))},null,512),[[h,n.convertFileSrc(a.imagesMeta.cover)]])])),header:(0,o.w5)((()=>[(0,o._)("span",{class:"image-card-title",onClick:t[1]||(t[1]=(...e)=>n.browseImages&&n.browseImages(...e))},(0,K.zw)(a.imagesMeta.title),1)])),action:(0,o.w5)((()=>[(0,o.Wm)(u,{type:"success",value:n.data.tags,"onUpdate:value":[t[2]||(t[2]=e=>n.data.tags=e),n.onUpdate],onCreate:n.onCreate},null,8,["value","onCreate","onUpdate:value"]),(0,o.Wm)(f,{justify:"space-around",size:10},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{text:"",onClick:t[3]||(t[3]=e=>n.emit("update",Object.assign({},a.imagesMeta)))},{icon:(0,o.w5)((()=>[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d)])),_:1})])),default:(0,o.w5)((()=>[(0,o.Uk)(" 编辑 ")])),_:1}),(0,o.Wm)(p,{onPositiveClick:t[4]||(t[4]=e=>n.emit("remove",a.imagesMeta.id)),"positive-text":"没错","negative-text":"算了"},{trigger:(0,o.w5)((()=>[(0,o.Wm)(g,{text:"",type:"error"},{icon:(0,o.w5)((()=>[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m)])),_:1})])),default:(0,o.w5)((()=>[(0,o.Uk)(" 移除 ")])),_:1})])),default:(0,o.w5)((()=>[(0,o.Uk)(" 真的要移除吗？ ")])),_:1})])),_:1})])),default:(0,o.w5)((()=>[(0,o._)("div",null,[a.imagesMeta.author?((0,o.wg)(),(0,o.j4)(i,{key:0,type:"info"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,K.zw)(a.imagesMeta.author),1)])),_:1})):(0,o.kq)("",!0),a.imagesMeta.intro?((0,o.wg)(),(0,o.iD)("div",R,[(0,o.Wm)(s,{"align-text":""},{default:(0,o.w5)((()=>[(0,o.Uk)((0,K.zw)(a.imagesMeta.intro),1)])),_:1})])):(0,o.kq)("",!0)])])),_:1})])}a(7658);var $=a(2040),A=a(212),E=a(3513),Y=a(2124),G=a(6473),Q=a(6967),X={name:"ImageCard",components:{NCard:M.ZP,NBlockquote:$.Z,NText:A.Z,NIcon:j.g,NButton:S.ZP,NSpace:F.Z,Pencil:G.Z,TrashBin:Q.Z,NPopconfirm:E.Z,NDynamicTags:Y.Z},props:{imagesMeta:Object},emits:["remove","update"],setup(e,t){const a=(0,v.tv)();let n=(0,l.qj)({tags:[{label:"你没见过不等于没有",value:"hello world 1"},{label:"不要给自己设限",value:"hello world 2"},{label:"不要说连升两级",value:"hello world 3"},{label:"直接升到 CEO 都是有可能的",value:"hello world 4"}]});function o(e){return{label:e,value:"v"+e}}function r(e){alert(e)}async function s(){a.push({path:"/drag",query:{}})}return{emit:t.emit,data:n,convertFileSrc:i.Lk,browseImages:s,onCreate:o,onUpdate:r}}};const J=(0,f.Z)(X,[["render",H],["__scopeId","data-v-10f3efce"]]);var V=J,ee={name:"MyLibrary",components:{ImageCard:V,FolderOpenOutline:B.Z,ImagesOutline:O.Z,NButton:S.ZP,NEmpty:W.Z,NModal:P.Z,NCard:M.ZP,NForm:Z.Z,NFormItem:T.ZP,NInput:U.Z,NGrid:N.Z,NGridItem:D.ZP,NIcon:j.g,NSpace:F.Z,NPagination:z.Z,Search:q.Z},setup(){const e=(0,L.U)(),t=(0,l.qj)({metaList:[],search:"",pagination:{current:1,pageSize:50,total:0},modal:{visible:!1,form:{id:null,title:"",author:"",intro:""},rules:{title:{required:!0,trigger:["focus","input","blur"],message:"请输入标题"}},path:"",cover:"",coverAsset:""}}),a=(0,l.iH)(null);function n(){t.modal={visible:!1,form:{id:null,title:"",author:"",intro:""},rules:{title:{required:!0,trigger:["focus","input","blur"],message:"请输入标题"}},path:"",cover:"",coverAsset:""}}async function r(){const e=t.pagination.current,a=t.pagination.pageSize;return s.getImagesMetaList(t.search.trim(),e,a).then((e=>{console.log("getImagesMetaList",e),t.metaList=e.list,t.pagination.current=e.pagination.current,t.pagination.pageSize=e.pagination.page_size,t.pagination.total=e.pagination.total}))}async function u(){C.WZ.open({title:"选择图片目录",directory:!0}).then((e=>(console.log("选择目录结果",e),s.getImagesFolderInfo(e).then((a=>{function n(){for(let e of a.files)if(!e.is_dir)return e.path;for(let e of a.files)if(e.is_dir)for(let t of e.files)return t}console.log("getImagesFolderInfo",e,a),t.modal.cover=n(),t.modal.coverAsset=(0,i.Lk)(t.modal.cover),t.modal.path=e,t.modal.form.title=a.name})))))}async function d(){return new Promise(((e,n)=>{a.value?.validate((a=>{if(!a){const a={path:t.modal.path,title:t.modal.form.title,author:t.modal.form.author||"",intro:t.modal.form.intro||"",cover:t.modal.cover};s.addImagesMeta(a).then((t=>{console.log("addImagesMeta",t),e(t)}),(e=>{n(e)}))}}))})).then((()=>(n(),r())))}async function c(){C.WZ.open({title:"选择封面",directory:!1,defaultPath:t.modal.path,filters:[{name:"image",extensions:["jpeg","jpg","webp","gif","png","bmp"]}]}).then((e=>{t.modal.cover=e,t.modal.coverAsset=(0,i.Lk)(t.modal.cover)}))}async function g(t){return console.log("removeImagesMeta",t),s.deleteImageMeta(t).then((()=>r()),(t=>{e.error(`移除失败：${t}`)}))}function m(e){console.log("showUpdateImagesMeta",e),t.modal={visible:!0,form:{id:e.id,title:e.title,author:e.author,intro:e.intro},rules:{title:{required:!0,trigger:["focus","input","blur"],message:"请输入标题"}},path:e.path,cover:e.cover,coverAsset:(0,i.Lk)(e.cover)}}function p(){n(),t.modal.visible=!0}async function f(){return new Promise(((e,n)=>{a.value?.validate((a=>{if(!a){const a={id:t.modal.form.id,path:t.modal.path,title:t.modal.form.title,author:t.modal.form.author||"",intro:t.modal.form.intro||"",cover:t.modal.cover};s.updateImagesMeta(a).then((t=>{console.log("updateImagesMeta",t),e(t)}),(e=>{n(e)}))}}))})).then((()=>(n(),r())))}function w(e){console.log("onSearchInputKeyUp",e),13===e.keyCode&&r()}return(0,o.YP)((()=>[t.pagination.current,t.pagination.pageSize]),r),r(),{imagesMetaForm:a,data:t,getImagesMetaList:r,selectFolder:u,addImagesMeta:d,changeCover:c,removeImagesMeta:g,showUpdateImagesMeta:m,showAddImagesMeta:p,updateImagesMeta:f,onSearchInputKeyUp:w}}};const te=(0,f.Z)(ee,[["render",x],["__scopeId","data-v-12947ec6"]]);var ae=te;const ne={class:"top-hover-area"},oe={class:"carousel-img"},re={class:"carousel-double-img-container"},le={key:0,class:"carousel-double-img"},ie={class:"carousel-double-img-container"},se={key:0,class:"carousel-double-img"},ue={key:3,style:{margin:"0 auto"}},de=["id"],ce=["id"],ge=["onClick"];function me(e,t,a,n,r,l){const i=(0,o.up)("ArrowBackCircleOutline"),s=(0,o.up)("n-icon"),u=(0,o.up)("n-button"),d=(0,o.up)("n-text"),c=(0,o.up)("n-divider"),g=(0,o.up)("n-radio"),m=(0,o.up)("n-radio-group"),p=(0,o.up)("n-switch"),f=(0,o.up)("n-list-item"),w=(0,o.up)("n-list"),h=(0,o.up)("n-layout-sider"),v=(0,o.up)("n-carousel-item"),y=(0,o.up)("n-carousel"),b=(0,o.up)("n-layout-content"),I=(0,o.up)("n-layout"),_=(0,o.up)("n-space"),k=(0,o.Q2)("lazy");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",ne,[(0,o.Wm)(u,{text:"",class:"back-button",onClick:n.goBack},{icon:(0,o.w5)((()=>[(0,o.Wm)(s,{size:"30"},{default:(0,o.w5)((()=>[(0,o.Wm)(i)])),_:1})])),_:1},8,["onClick"])]),(0,o.Wm)(I,{"has-sider":"","sider-placement":"right",class:"screen-height"},{default:(0,o.w5)((()=>[(0,o.Wm)(b,{class:"screen-height"},{default:(0,o.w5)((()=>[(0,o.Wm)(I,{"has-sider":"",class:"screen-height"},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{"collapse-mode":"transform","collapsed-width":4,width:240,"show-collapsed-content":!1,"show-trigger":"arrow-circle",collapsed:n.data.chaptersCollapsed,"content-style":"padding: 0px 24px;","native-scrollbar":!1,onCollapse:t[3]||(t[3]=e=>n.data.chaptersCollapsed=!0),onExpand:t[4]||(t[4]=e=>n.data.chaptersCollapsed=!1)},{default:(0,o.w5)((()=>[(0,o._)("div",null,[(0,o.Wm)(c,{"title-placement":"left"},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{depth:"3"},{default:(0,o.w5)((()=>[(0,o.Uk)(" 浏览设置 ")])),_:1})])),_:1}),(0,o._)("div",null,[(0,o.Wm)(m,{value:n.data.browseSettings.browseType,"onUpdate:value":t[0]||(t[0]=e=>n.data.browseSettings.browseType=e),size:"small"},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.data.browseSettings.browseTypes,(e=>((0,o.wg)(),(0,o.j4)(g,{style:{padding:"2px 5px"},key:e.type,value:e.type,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["value"]),(0,o.Wm)(p,{value:n.data.browseSettings.homePage,"onUpdate:value":t[1]||(t[1]=e=>n.data.browseSettings.homePage=e),style:{"margin-top":"15px"},disabled:n.data.browseSettings.browseType in{single:1,scroll:1}},{checked:(0,o.w5)((()=>[(0,o.Uk)(" 有首页 ")])),unchecked:(0,o.w5)((()=>[(0,o.Uk)(" 无首页 ")])),_:1},8,["value","disabled"])]),(0,o.Wm)(c,{"title-placement":"left"},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{depth:"3"},{default:(0,o.w5)((()=>[(0,o.Uk)(" 子目录 ")])),_:1})])),_:1}),n.data.folderInfo.files?((0,o.wg)(),(0,o.j4)(w,{key:0},{default:(0,o.w5)((()=>[(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,{class:"chapter-item",type:""+(""===n.data.currentPath?"info":"default"),onClick:t[2]||(t[2]=e=>n.selectChapter(""))},{default:(0,o.w5)((()=>[(0,o.Uk)(" [默认] ("+(0,K.zw)(n.data.folderInfo.files.filter((e=>!e.is_dir)).length)+"P) ",1)])),_:1},8,["type"])])),_:1}),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.data.folderInfo.files.filter((e=>e.is_dir)),(e=>((0,o.wg)(),(0,o.j4)(f,{key:e.path},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{class:"chapter-item",type:""+(n.data.currentPath===e.path?"info":"default"),onClick:t=>n.selectChapter(e.path)},{default:(0,o.w5)((()=>[(0,o.Uk)((0,K.zw)(e.name)+" ("+(0,K.zw)(e.files.length)+"P) ",1)])),_:2},1032,["type","onClick"])])),_:2},1024)))),128))])),_:1})):(0,o.kq)("",!0)])])),_:1},8,["collapsed"]),(0,o.Wm)(b,{onClick:t[5]||(t[5]=e=>n.data.chaptersCollapsed=!0),"native-scrollbar":!1,ref:"contentRef"},{default:(0,o.w5)((()=>["single"===n.data.browseSettings.browseType?((0,o.wg)(),(0,o.j4)(y,{key:0,ref:"carouselRef",effect:"fade","slides-per-view":1,style:{height:"100vh"},mousewheel:"",direction:"vertical","show-dots":!1,loop:!1,"onUpdate:currentIndex":n.onCurrentIndex},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.currentImages,(e=>((0,o.wg)(),(0,o.j4)(v,{class:"center",key:e.index},{default:(0,o.w5)((()=>[(0,o.wy)((0,o._)("img",oe,null,512),[[k,n.convertFileSrc(e.path)]])])),_:2},1024)))),128))])),_:1},8,["onUpdate:currentIndex"])):"right-left"===n.data.browseSettings.browseType?((0,o.wg)(),(0,o.j4)(y,{key:1,ref:"doublePageCarouselRef",effect:"fade","slides-per-view":1,style:{height:"100vh"},mousewheel:"",direction:"vertical","show-dots":!1,loop:!1,"onUpdate:currentIndex":n.onDoublePageCurrentIndex},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.currentImagesDoublePage,(e=>((0,o.wg)(),(0,o.j4)(v,{class:"center",key:e[0].index},{default:(0,o.w5)((()=>[(0,o._)("div",re,[e.length>1?(0,o.wy)(((0,o.wg)(),(0,o.iD)("img",le,null,512)),[[k,n.convertFileSrc(e[1].path)]]):(0,o.kq)("",!0),(0,o.wy)((0,o._)("img",{class:(0,K.C_)(""+(1===e.length?"carousel-img":"carousel-double-img"))},null,2),[[k,n.convertFileSrc(e[0].path)]])])])),_:2},1024)))),128))])),_:1},8,["onUpdate:currentIndex"])):"left-right"===n.data.browseSettings.browseType?((0,o.wg)(),(0,o.j4)(y,{key:2,ref:"doublePageCarouselRef",effect:"fade","slides-per-view":1,style:{height:"100vh"},mousewheel:"",direction:"vertical","show-dots":!1,loop:!1,"onUpdate:currentIndex":n.onDoublePageCurrentIndex},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.currentImagesDoublePage,(e=>((0,o.wg)(),(0,o.j4)(v,{class:"center",key:e[0].index},{default:(0,o.w5)((()=>[(0,o._)("div",ie,[(0,o.wy)((0,o._)("img",{class:(0,K.C_)(""+(1===e.length?"carousel-img":"carousel-double-img"))},null,2),[[k,n.convertFileSrc(e[0].path)]]),e.length>1?(0,o.wy)(((0,o.wg)(),(0,o.iD)("img",se,null,512)),[[k,n.convertFileSrc(e[1].path)]]):(0,o.kq)("",!0)])])),_:2},1024)))),128))])),_:1},8,["onUpdate:currentIndex"])):"scroll"===n.data.browseSettings.browseType?((0,o.wg)(),(0,o.iD)("div",ue,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.currentImages,(e=>(0,o.wy)(((0,o.wg)(),(0,o.iD)("img",{key:e.index,class:"scroll-img",id:`scroll-img-${e.index}`},null,8,de)),[[k,n.convertFileSrc(e.path)]]))),128))])):(0,o.kq)("",!0)])),_:1},512)])),_:1})])),_:1}),(0,o.Wm)(h,{ref:"siderRef",width:220,"native-scrollbar":!1,bordered:"","content-style":"padding: 20px;"},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{vertical:""},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.currentImages,(e=>((0,o.wg)(),(0,o.iD)("div",{key:e.index,id:`preview-${e.index}`},[(0,o.wy)((0,o._)("img",{class:(0,K.C_)(""+(n.data.activeImageIndex===e.index?"preview-img-active":"preview-img")),onClick:t=>n.onPreviewImageClick(e.index)},null,10,ge),[[k,n.convertFileSrc(e.path)]])],8,ce)))),128))])),_:1})])),_:1},512)])),_:1})])}var pe=a(4605),fe=a(3018),we=a(9762),he=a(568),ve=a(7602),ye=a(796),be=a(7745),Ie=a(9332),_e=a(711),ke=a(3105),xe=a(246),Ce=a(5740),Se={name:"ImageBrowser",components:{NLayout:pe.ZP,NLayoutSider:fe.Z,NLayoutContent:we.Z,NList:he.ZP,NListItem:ve.Z,NText:A.Z,NCarousel:ye.C,NCarouselItem:be.Z,NSpace:F.Z,NRadioGroup:Ie.Z,NRadio:_e.Z,NDivider:ke.Z,NSwitch:xe.Z,ArrowBackCircleOutline:Ce.Z,NIcon:j.g,NButton:S.ZP},setup(){let e=(0,l.qj)({meta:{},folderInfo:{},currentPath:"",chaptersCollapsed:!0,activeImageIndex:0,browseSettings:{browseType:"single",browseTypes:[{type:"single",name:"单页"},{type:"scroll",name:"滚动"},{type:"right-left",name:"右左"},{type:"left-right",name:"左右"}],homePage:!1}});const t=(0,o.Fl)((()=>{if(!e.folderInfo.files)return[];if(""===e.currentPath)return e.folderInfo.files.filter((e=>!e.is_dir)).map(((e,t)=>({path:e.path,index:t})));{let t=e.folderInfo.files.filter((t=>t.path===e.currentPath))[0];return t?t.files.map(((e,t)=>({path:e,index:t}))):[]}})),a=(0,o.Fl)((()=>{if(0===t.value.length)return[];let a=[];e.browseSettings.homePage&&a.push([t.value[0]]);for(let n=e.browseSettings.homePage?1:0;n<t.value.length;n+=2){let e=[t.value[n]];n+1<t.value.length&&e.push(t.value[n+1]),a.push(e)}return a})),n=(0,l.iH)(null),r=(0,l.iH)(null),u=(0,l.iH)(null),d=(0,l.iH)(null),c=(0,v.tv)(),g=c.currentRoute.value.query;async function m(){return s.getImagesMeta(parseInt(g.id)).then((t=>{console.log("getImagesMeta",t),e.meta=t}))}async function p(t){return s.getImagesFolderInfo(t).then((t=>{console.log("getImagesFolderInfo",t),e.folderInfo=t,0===e.folderInfo.files.filter((e=>!e.is_dir)).length&&e.folderInfo.files.length>0&&(e.currentPath=e.folderInfo.files[0].path)}))}async function f(t){return s.getBrowseSettings(t).then((a=>{console.log("getBrowseSettings",t,a),e.browseSettings.browseType=a.browse_type,e.browseSettings.homePage=a.home_page,e.currentPath=a.current_path,(0,o.Y3)((()=>{setTimeout((()=>{I(a.current_index)}),200)}))}),(e=>{console.warn("getBrowseSettings err",t,e)})).then((()=>{(0,o.YP)((()=>[e.browseSettings.browseType,e.browseSettings.homePage,e.currentPath,e.activeImageIndex]),(([t,a,n,o])=>{e.meta.id&&s.updateBrowseSettings(e.meta.id,t,a,n,o).then((()=>{}),(()=>{}))}))}))}function w(t){e.currentPath=t,"single"===e.browseSettings.browseType?n.value.to(0):"left-right"!==e.browseSettings.browseType&&"right-left"!==e.browseSettings.browseType||r.value.to(0)}function h(t){e.activeImageIndex=t;const a=`preview-${e.activeImageIndex}`,n=document.getElementById(a);u.value.scrollTo({top:n.offsetTop-5,behavior:"smooth"})}function y(t){console.log("onDoublePageCurrentIndex",t),e.activeImageIndex=a.value[t][0].index;const n=`preview-${e.activeImageIndex}`,o=document.getElementById(n);u.value.scrollTo({top:o.offsetTop-5,behavior:"smooth"})}function b(t){if(e.activeImageIndex=t,"single"===e.browseSettings.browseType)n.value.to(t);else if("left-right"===e.browseSettings.browseType||"right-left"===e.browseSettings.browseType){let a;a=e.browseSettings.homePage?parseInt((t+1)/2):parseInt(t/2),r.value.to(a)}else if("scroll"===e.browseSettings.browseType){const e=`scroll-img-${t}`,a=document.getElementById(e);d.value.scrollTo({top:a.offsetTop,behavior:"smooth"})}}function I(t){e.activeImageIndex=t;const a=`preview-${e.activeImageIndex}`,n=document.getElementById(a);u.value.scrollTo({top:n.offsetTop-5,behavior:"smooth"}),b(t)}function _(){c.back()}return{data:e,currentImages:t,currentImagesDoublePage:a,convertFileSrc:i.Lk,selectChapter:w,onCurrentIndex:h,onDoublePageCurrentIndex:y,carouselRef:n,doublePageCarouselRef:r,siderRef:u,contentRef:d,onPreviewImageClick:b,getImagesMeta:m,getImagesFolderInfo:p,getBrowseSettings:f,goBack:_}},mounted(){this.getImagesMeta().then((()=>{this.getImagesFolderInfo(this.data.meta.path),this.getBrowseSettings(this.data.meta.id)}))}};const We=(0,f.Z)(Se,[["render",me],["__scopeId","data-v-2d219836"]]);var Pe=We;const Me=e=>((0,o.dD)("data-v-c37e091e"),e=e(),(0,o.Cn)(),e),Ze=Me((()=>(0,o._)("h4",null,"拖拽到这里上传",-1))),Te=[Ze];function Ue(e,t,a,r,l,i){return(0,o.wy)(((0,o.wg)(),(0,o.iD)("div",{class:(0,K.C_)(["mask",r.data.changeColor]),id:"mask"},Te,2)),[[n.F8,r.data.show]])}a(8675),a(3408),a(4590);var Ne={name:"MyDrag",setup(){const e={on:"red",off:"black"};let t=(0,l.qj)({tempIndex:0,fileList:[],accept:l.iH<String>".jpg,.gif,.png,.jpeg",show:!0,changeColor:e.off});function a(a){t.changeColor=a?e.on:e.off}function n(){const e=document.querySelector(".mask");e&&(e.addEventListener("dragleave",(e=>{e.stopPropagation(),e.preventDefault(),a(!1)})),e.addEventListener("drop",(e=>{e.stopPropagation(),e.preventDefault(),o(e)})),e.addEventListener("dragover",(e=>{e.stopPropagation(),e.preventDefault(),a(!0)})))}const o=e=>{if(console.debug("1. 拖入事件开始",e.dataTransfer),e.dataTransfer){const s=[].slice.call(e.dataTransfer.files).filter((a=>(console.log(e.dataTransfer),!t.accept||r(a,t.accept))));t.fileList=s.map((e=>i(e))),console.debug("2. fileList为 ",t.fileList),a(!1);var n=e.dataTransfer.files;if(console.debug("3. files.length ",n.length),n.length>0){var o=new FileReader,l=[];o.readAsArrayBuffer(n[0]),o.onloadend=function(e){if(e.target.readyState==FileReader.DONE)for(var t=e.target.result,a=new Uint8Array(t),n=0;n<a.length;n++)l.push(a[n])},alert(l)}}},r=(e,t="")=>{const{type:a,name:n}=e;if(0===t.length)return!0;const o=n.indexOf(".")>-1?`.${n.split(".").pop()}`:"",r=a.replace(/\/.*$/,"");return t.split(",").map((e=>e.trim())).filter((e=>e)).some((e=>/\..+$/.test(e)?o===e:/\/\*$/.test(e)?r===e.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(e)?a===e:void 0))},i=e=>(e.uid=Date.now()+t.tempIndex++,{status:"ready",name:e.name,size:e.size,percentage:0,uid:e.uid,raw:e});return n(),{data:t}}};const De=(0,f.Z)(Ne,[["render",Ue],["__scopeId","data-v-c37e091e"]]);var je=De;const Fe=[{path:"/",name:"my-lib",component:ae},{path:"/browse",name:"browse",component:Pe},{path:"/drag",name:"drag",component:je}],ze=(0,v.p7)({history:(0,v.PO)(),routes:Fe});var Le=ze,Be=a(2644);(0,n.ri)(h).use(Le).use(Be.Z,{loading:a(8938)}).mount("#app")},8938:function(e,t,a){e.exports=a.p+"img/XOsX.816acf33.gif"}},t={};function a(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,a),r.exports}a.m=e,function(){var e=[];a.O=function(t,n,o,r){if(!n){var l=1/0;for(d=0;d<e.length;d++){n=e[d][0],o=e[d][1],r=e[d][2];for(var i=!0,s=0;s<n.length;s++)(!1&r||l>=r)&&Object.keys(a.O).every((function(e){return a.O[e](n[s])}))?n.splice(s--,1):(i=!1,r<l&&(l=r));if(i){e.splice(d--,1);var u=o();void 0!==u&&(t=u)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[n,o,r]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.p="/"}(),function(){var e={143:0};a.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,r,l=n[0],i=n[1],s=n[2],u=0;if(l.some((function(t){return 0!==e[t]}))){for(o in i)a.o(i,o)&&(a.m[o]=i[o]);if(s)var d=s(a)}for(t&&t(n);u<l.length;u++)r=l[u],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(d)},n=self["webpackChunkimageview"]=self["webpackChunkimageview"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=a.O(void 0,[998],(function(){return a(9254)}));n=a.O(n)})();
//# sourceMappingURL=app.0fa39a5e.js.map